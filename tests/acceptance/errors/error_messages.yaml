suite: error_messages
description: Error message quality and context per ADR-010

tests:
  - name: undefined_reference_includes_path
    given:
      config: |
        value: ${nonexistent.key}
    when:
      access: value
    then:
      error:
        message_contains: "nonexistent"

  - name: undefined_env_var_includes_var_name
    given:
      config: |
        secret: ${env:HOLOCONF_UNDEFINED_VAR_12345}
    when:
      access: secret
    then:
      error:
        message_contains: "HOLOCONF_UNDEFINED_VAR_12345"

  - name: malformed_expression_helpful_error
    given:
      config: |
        broken: ${unclosed
    when:
      access: broken
    then:
      error:
        message_contains: "Unexpected end of input"

  # NOTE: Circular reference tests are disabled pending bug fix
  # The current implementation does not properly detect transitive circular references
  # and causes a stack overflow / segfault instead of returning an error
  # See: config.rs resolve_interpolation - needs proper cycle tracking

  # - name: circular_reference_detected
  #   given:
  #     config: |
  #       a: ${b}
  #       b: ${a}
  #   when:
  #     access: a
  #   then:
  #     error:
  #       message_contains: "circular"

  # - name: circular_reference_chain_detected
  #   given:
  #     config: |
  #       first: ${second}
  #       second: ${third}
  #       third: ${first}
  #   when:
  #     access: first
  #   then:
  #     error:
  #       message_contains: "circular"

  - name: missing_resolver_prefix
    given:
      config: |
        bad: ${:value}
    when:
      access: bad
    then:
      error:
        message_contains: "Empty"

  - name: key_not_found_includes_key_name
    given:
      config: |
        existing: value
    when:
      access: nonexistent_key
    then:
      error:
        message_contains: "nonexistent_key"

  - name: nested_key_not_found
    given:
      config: |
        parent:
          child: value
    when:
      access: parent.nonexistent_child
    then:
      error:
        message_contains: "nonexistent_child"

  - name: array_index_out_of_bounds
    given:
      config: |
        items:
          - first
          - second
        value: ${items[99]}
    when:
      access: value
    then:
      error:
        message_contains: "not found"
